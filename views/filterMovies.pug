//- Filter movies view
//- Allows users to filter their movie collection by various criteria
//- Author: Tien Dung Pham (n01718811)

extends layout

block content
  //- Page header with title and action buttons
  .movies-header
    h1 ðŸ” Filter Movies
    .filter-actions
      a.btn.btn-secondary(href="/movies") 
        span ðŸ“½ï¸ 
        | Back to All Movies
      a.btn.btn-primary(href="/movies/add") 
        span âž• 
        | Add New Movie

  //- Filter form container
  .filter-container
    form.filter-form(method='POST', action='/movies/filter')
      .filter-grid
        //- Movie name search field
        .form-group
          label(for='name') Movie Name:
          input.form-control(
            type='text', 
            id='name', 
            name='name', 
            value=filtered ? filters.name : '',
            placeholder='Search by movie name'
          )
        
        //- Genre dropdown filter
        .form-group
          label(for='genre') Genre:
          select.form-control(id='genre', name='genre')
            option(value='all', selected=!filtered || !filters.genre || filters.genre === 'all') All Genres
            each genre in availableGenres
              option(
                value=genre, 
                selected=filtered && filters.genre === genre
              )= genre
        
        //- Year range filter (min and max)
        .form-group
          label(for='minYear') Year Range:
          .year-range
            input.form-control(
              type='text', 
              id='minYear', 
              name='minYear',
              pattern='[0-9]{4}',
              value=filtered ? filters.minYear : '',
              placeholder='From (e.g. 1980)'
            )
            span.to to
            input.form-control(
              type='text', 
              id='maxYear', 
              name='maxYear',
              pattern='[0-9]{4}',
              value=filtered ? filters.maxYear : '',
              placeholder='To (e.g. 2024)'
            )
          small.form-text Enter 4-digit years between 1900 and 2025
        
        //- Rating range filter (min and max)
        .form-group
          label(for='minRating') Rating Range:
          .rating-range
            input.form-control(
              type='number', 
              id='minRating', 
              name='minRating', 
              min='1',
              max='10',
              step='0.1',
              value=filtered ? filters.minRating : '',
              placeholder='Min'
            )
            span.to to
            input.form-control(
              type='number', 
              id='maxRating', 
              name='maxRating', 
              min='1',
              max='10',
              step='0.1',
              value=filtered ? filters.maxRating : '',
              placeholder='Max'
            )
      
      //- Filter action buttons
      .filter-actions
        button.btn.btn-primary(type='submit') 
          span ðŸ” 
          | Filter Movies
        if filtered
          a.btn.btn-secondary(href='/movies/filter') 
            span ðŸ—‘ï¸ 
            | Clear Filters

  //- Results heading showing number of movies found
  if filtered
    h2.results-heading Filtered Results (#{movies.length} movies)
  else
    h2.results-heading All Movies (#{movies.length} movies)

  //- Display movie cards or empty state
  if movies && movies.length > 0
    .movies-grid
      each movie in movies
        .movie-card
          //- Movie cover image
          .movie-cover
            img.movie-image(
              src=movie.coverImage, 
              alt=movie.name,
              onerror="this.src='/images/default-movie.jpg'"
            )
          
          //- Movie content section
          .movie-content
            //- Movie title and year
            .movie-header
              h3.movie-title= movie.name
              .movie-year (#{movie.year})
            
            //- Star rating display
            .movie-rating
              - let stars = '';
              - for (let i = 1; i <= 10; i++) {
                - if (i <= movie.rating) {
                  span.star.filled â­
                - } else {
                  span.star â˜†
                - }
              - }
              span.rating-value (#{movie.rating}/10)
            
            //- Movie description
            .movie-description= movie.description
            
            //- Genre badges
            .movie-genres
              each genre in movie.genres
                span.genre-badge= genre
            
            //- Action buttons (View, Edit, Delete)
            .movie-actions
              a.btn.btn-sm.btn-outline(href=`/movies/${movie._id}`)
                span ðŸ‘ï¸
                | View
              a.btn.btn-sm.btn-outline(href=`/movies/edit/${movie._id}`) 
                span âœï¸ 
                | Edit
              form.delete-form(
                action=`/movies/delete/${movie._id}`,
                method="POST",
                onsubmit=`return confirmDelete("${movie.name}")`
              )
                button.btn.btn-sm.btn-danger(type="submit") 
                  span ðŸ—‘ï¸ 
                  | Delete

            //- Movie footer with creation date
            .movie-footer
              small Added on #{movie.createdAt.toLocaleDateString()}
  else
    //- Empty state when no movies match filters
    .empty-state
      if filtered
        h2 No movies found
        p No movies match your filter criteria.
        a.btn.btn-primary(href="/movies/filter") 
          span ðŸ” 
          | Try Different Filters
      else
        h2 No movies yet
        p You haven't added any movies to your collection.
        a.btn.btn-primary(href="/movies/add") 
          span âž• 
          | Add Your First Movie