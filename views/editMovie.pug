//- Edit movie form view
//- Form for updating an existing movie's information
//- Pre-fills form with current movie data
//- Author: Tien Dung Pham (n01718811)

extends layout

block content
  .form-container
    h1 Edit Movie
    p Update movie information

    //- Display validation errors if any
    if errors
      each error in errors
        .alert.alert-danger= error.msg

    //- Movie update form
    form(method="POST", action=`/movies/edit/${movie._id}`)
      //- Movie title input (pre-filled)
      .form-group
        label(for="name") Movie Title:
        input.form-control(
          type="text", 
          name="name", 
          id="name",
          value=formData ? formData.name : movie.name,
          required,
          placeholder="Enter movie title"
        )
      
      //- Description textarea (pre-filled, minimum 10 characters)
      .form-group
        label(for="description") Description:
        textarea.form-control(
          name="description", 
          id="description",
          rows="4",
          minlength="10",
          required,
          placeholder="Enter movie description (minimum 10 characters)"
        )= formData ? formData.description : movie.description
        small.form-text Minimum 10 characters
      
      //- Release year input (pre-filled, 1900-2025)
      .form-group
        label(for="year") Release Year:
        input.form-control(
          type="text", 
          name="year", 
          id="year",
          pattern="[0-9]{4}",
          value=formData ? formData.year : movie.year,
          required,
          placeholder="e.g. 2024"
        )
        small.form-text Enter a 4-digit year between 1900 and 2025
      
      //- Cover image URL input (pre-filled, optional)
      .form-group
        label(for="coverImage") Cover Image URL:
        input.form-control(
          type="url", 
          name="coverImage", 
          id="coverImage",
          value=formData ? formData.coverImage : movie.coverImage,
          placeholder="Enter image URL"
        )
        small.form-text Enter a URL for the movie cover image
      
      //- Genre checkboxes (pre-checked based on current genres)
      .form-group
        label Genres:
        .genres-checkbox
          each genre in availableGenres
            .checkbox-item
              //- Determine if checkbox should be checked
              - let isChecked = false;
              - if (formData && formData.genres) {
              -   isChecked = formData.genres.includes(genre);
              - } else {
              -   isChecked = movie.genres.includes(genre);
              - }
              input(
                type="checkbox", 
                name="genres", 
                id=`genre-${genre}`,
                value=genre,
                checked=isChecked
              )
              label(for=`genre-${genre}`)= genre
        small.form-text Select at least one genre
      
      //- Rating input (pre-filled, 1-10 scale)
      .form-group
        label(for="rating") Rating (1-10):
        input.form-control(
          type="number", 
          name="rating", 
          id="rating",
          min="1",
          max="10",
          step="0.1",
          value=formData ? formData.rating : movie.rating,
          required
        )
        small.form-text Rate from 1 (poor) to 10 (excellent)
      
      //- Form action buttons
      .form-actions
        button.btn.btn-primary(type="submit") 
          span ✏️ 
          | Update Movie
        a.btn.btn-secondary(href="/movies") 
          span ↩️ 
          | Cancel